import { useRouter } from "next/dist/client/router";
import { useState } from "react";
import BikeForm from "../../components/bike-form";
import { supabase } from "../../supabase-client";

export default function NewBike() {
  const [bikeMake, setBikeMake] = useState("");
  const [bikeModel, setBikeModel] = useState("");
  const [bikeYear, setBikeYear] = useState("");
  const [bikeImagePath, setBikeImagePath] = useState("");
  const router = useRouter();
  const session = supabase.auth.session();

  return (
    <>
      <h1>Show bikes</h1>
    </>
  );
}

export const getServerSideProps = async (context) => {
  // get the user using the "sb:token" cookie
  const { user } = await supabase.auth.api.getUserByCookie(context.req);
  if (!user) {
    return {
      redirect: {
        destination: "/signin",
        permanent: false
      }
    };
  }

  supabase.auth.setAuth(context.req.cookies["sb:token"]);
  const { data: bikes, error } = await supabase
    .from("bikes")
    .select({
      make: bikeMake,
      model: bikeModel,
      production_year: bikeYear
    })
    .match({
      id: bike.id
    });

  return {
    props: {}
  };
};
